
<header>
    <div class="user-header">
        <a href="/">
            <img class="logo" src="/img/logo.png">
        </a>

        <div class="search-container">
            <form action="/store/search">
                <div class="search-word">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <input type="text" placeholder="검색어를 입력하세요..." name="keyword">
                    <button class="search-btn" type="submit"><img src="/img/search-icon.png" style="width:3vh; height: 3vh;"></button>
                </div>
            </form>
            <div class="popular-searches">
                <span>인기검색어1</span>
                <span>인기검색어2</span>
                <span>인기검색어3</span>
                <span>인기검색어4</span>
                <span>인기검색어5</span>
                <form action="/store/search" id="findByLoc">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <input type="hidden" name="keyword" value="">
                    <a href="" onclick="myLocation()" class="nearby"><button class="nearby" type="submit">가까운 곳 찾기</button></a>
<!--                    <button class="nearby" type="submit"></button>-->
                </form>
                <a href="" class="game">
                    <img id="game" src="/img/gamepad-icon.png" alt="게임패드"></a>
            </div>
        </div>

        <!-- menu -->
        <div class="menu">
            <!-- 비로그인(게스트) 상태일 때만 표시 -->
            <div sec:authorize="isAnonymous()">
                <button onclick="location.href='/login'" class="login">로그인</button>
                <button onclick="location.href='/signup'" class="signup">회원가입</button>
            </div>

            <!-- 로그인(인증) 상태일 때만 표시 -->
            <div sec:authorize="isAuthenticated()">
                <!-- 현재 로그인한 사용자의 아이디(혹은 이름) 표시 -->
                <span th:text="${#authentication.name}"></span>님 환영합니다!
                <!-- 로그아웃 -->
                <form th:action="@{/logout}" method="post" style="display:inline;">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <button type="submit" class="logout">로그아웃</button>
                </form>
            </div>

            <!-- 항상 보이는 메뉴 버튼이라면 그대로 둠 -->
            <button class="menu-btn">
                <img src="/img/menu-icon.png" alt="마이페이지">
            </button>
        </div>
    </div>
</header>

<script>


//    function myLocation() {
//        navigator.geolocation.getCurrentPosition(function (position) {
//            // position은 현재 사용자의 위치 정보를 가지고 있음
//            // 이 정보를 kakao.maps.LatLng 객체로 변환해야 함
//            let coords = new kakao.maps.LatLng(position.coords.latitude, position.coords.longitude);
//            // 변환된 좌표로 상세 주소 검색
//            searchDetailAddrFromCoords(coords, function (result, status) {
//                if (status === kakao.maps.services.Status.OK) {
//
//                    const form = document.querySelector('form[id="findByLoc"]');
//                    console.log(form);
//                    const locationInput = form.querySelector('input[name="keyword"]');
//                    console.log(locationInput);
//                    locationInput.value = result[0].road_address.road_name;
//                    form.submit();
//                }
//            });
//        });
//    }
//
//    function searchDetailAddrFromCoords(coords, callback) {
//        // 좌표로 법정동 상세 주소 정보를 요청합니다
//        let geocoder = new kakao.maps.services.Geocoder();
//        geocoder.coord2Address(coords.getLng(), coords.getLat(), callback);
//    }
//
let geocoder = new kakao.maps.services.Geocoder(); // ✅ 함수 내부에서 선언

function myLocation() {

    navigator.geolocation.getCurrentPosition(function (position) {
        let coords = new kakao.maps.LatLng(position.coords.latitude, position.coords.longitude);

        searchDetailAddrFromCoords(coords, function (result, status) {
            if (status === kakao.maps.services.Status.OK) {
                const form = document.querySelector('form[id="findByLoc"]');
                const locationInput = form.querySelector('input[name="keyword"]');
                locationInput.value = result[0].road_address?.road_name || "알 수 없는 주소";
                form.submit();
            } else {
                console.error("❌ 주소 검색 실패:", status);
            }
        });
    });
}

function searchDetailAddrFromCoords(coords, callback) {
    if (!geocoder) {
        console.error("❌ Geocoder를 생성할 수 없습니다!");
        return;
    }
    geocoder.coord2Address(coords.getLng(), coords.getLat(), callback);
}

</script>